# å‰ç«¯å·¥å…·å‡½æ•°å¼€å‘

æœ¬ç¯‡ä»ä¸€ä¸ªéœ€æ±‚å‡ºå‘ï¼Œå¼€å‘ä¸€ä¸ªå‰ç«¯å·¥å…·å‡½æ•°ï¼Œå¹¶ä¸€æ­¥æ­¥å¯¹å®ƒå®Œå–„ã€å°è£…ï¼Œæé«˜å®ƒçš„æ˜“ç”¨æ€§ã€å¤ç”¨æ€§ã€å¯ç»´æŠ¤æ€§ã€‚

## éœ€æ±‚

ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå•ä½è½¬åŒ–ã€‚å¦‚ `setUnit(100)` è¿”å› 1ç™¾ï¼›`setUnit(1000)` è¿”å› 1åƒã€‚

é¦–å…ˆçœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚

```js
function setUnit(num) {
  if (num < 1000) {
    return num;
  } else if (num < 10000) {
    return `${Math.floor(num / 1000)}åƒ`;
  } else if (num < 100000) {
    return `${Math.floor(num / 10000)}ä¸‡`;
  } else if (num < 1000000) {
    return `${Math.floor(num / 100000)}åä¸‡`;
  }
}
```

è¿™ä¸ªå‡½æ•°ç›®å‰æœ‰å¾ˆå¤šç¼ºé™·ï¼Œæ¯”å¦‚å®ƒæœ€å¤šåªèƒ½è½¬æ¢åˆ°åä¸‡ï¼Œä¸”æ²¡åŠæ³•æ·»åŠ å•ä½ï¼Œä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§éƒ½å¾ˆå·®ã€‚

## æ‰©å±•æ€§æ”¹ç‰ˆ
### ç¬¬ä¸€ç‰ˆæ”¹è¿›

é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿›è¡Œç¬¬ä¸€ç‰ˆæ”¹è¿›ã€‚

å…³äºè½¬æ¢ï¼Œå¯ä»¥è®¾è®¡ä¸€ä¸ª `Map` æ˜ å°„ï¼Œå°†å•ä½ä¸è½¬æ¢çš„å€æ•°å¯¹åº”èµ·æ¥ï¼Œè¿™æ ·åœ¨è½¬æ¢æ—¶ï¼Œåªéœ€è¦éå†è¿™ä¸ª `Map`ï¼Œå°±å¯ä»¥å®Œæˆè½¬æ¢ã€‚

```js
const unitMap = new Map([
  'ç™¾': 100,
  'åƒ': 1000,
  'ä¸‡': 10000,
  'åä¸‡': 100000,
]);

function setUnit(value, unit) {
  return value / unitMap.get(unit) + unit;
}
```

è¿™ä¸€ç‰ˆçš„ä¿®æ”¹å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œç”¨æˆ·å¯ä»¥æ·»åŠ å•ä½ï¼Œå¹¶ä¸”è½¬æ¢çš„èŒƒå›´ä¹Ÿæ–¹ä¾¿æ‰©å¤§ï¼Œåªéœ€è¦åœ¨æ˜ å°„ä¸Šæ·»åŠ å¯¹åº”çš„å•ä½å³å¯ã€‚

ä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œç›®å‰çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯åç»­æ–°å¢å•ä½è¿˜æ˜¯éœ€è¦äººä¸ºç»´æŠ¤ï¼Œå¦‚æœé‡åˆ°ä¸€äº›å†·é—¨å•ä½ï¼Œåªæœ‰éƒ¨åˆ†ç»„ä»¶å¸¸è§éœ€è¦ä½¿ç”¨ï¼Œç›´æ¥æ·»åŠ åœ¨ `Map` é‡Œç»´æŠ¤æˆæœ¬ä¹Ÿä¼šæé«˜ã€‚

### ç¬¬äºŒç‰ˆæ”¹è¿›

é’ˆå¯¹ç¬¬ä¸€ç‰ˆæ”¹è¿›çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿›è¡Œç¬¬äºŒç‰ˆæ”¹è¿›ã€‚

å¯¹äºä¸€äº›å†·é—¨å•ä½ï¼Œå¯ä»¥è®©ä½¿ç”¨è€…é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°ä»¥ `Map` æ˜ å°„çš„æ–¹å¼ä¼ é€’è¿›æ¥ï¼Œè¿™æ ·å°±å¯ä»¥åŠ¨æ€çš„æ·»åŠ å•ä½äº†ã€‚æœ‰ä¸¤ç§æ–¹å¼å¤„ç†è¯¥å‚æ•°ï¼š
1. å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æœ‰å€¼ï¼ˆå³ç”¨æˆ·ä¼ äº†æ˜ å°„ï¼‰ï¼Œåˆ™ä½¿ç”¨ç”¨æˆ·ä¼ çš„æ˜ å°„ã€‚
2. å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æœ‰å€¼ï¼ˆå³ç”¨æˆ·ä¼ äº†æ˜ å°„ï¼‰ï¼Œåˆ™åˆå¹¶é»˜è®¤æ˜ å°„å’Œç”¨æˆ·çš„æ˜ å°„ã€‚

ä¸Šæ–¹ä¸¤ä¸ªæ­¥éª¤æ›´æ¨èä½¿ç”¨ç¬¬äºŒç§ï¼Œå› ä¸ºç¬¬ä¸€ç§ç›´æ¥æ‘’å¼ƒä¸ç”¨é»˜è®¤æ˜ å°„çš„æ–¹å¼ï¼Œè®©é»˜è®¤æ˜ å°„æ¯«æ— æ„ä¹‰ï¼Œç”¨æˆ·å¦‚æœä¼ å‚æ•°è¿˜å¾—è‡ªå·±æŠŠé»˜è®¤æ˜ å°„å†…çš„å€¼è‡ªå·±å†™ä¸€éã€‚

```js
const unitMap = new Map([
  'ç™¾': 100,
  'åƒ': 1000,
  'ä¸‡': 10000,
  'åä¸‡': 100000,
]);

function setUnit(value, unit, customUnitMap) { // [!code focus]
  const finallyUnitMap = new Map([ // [!code focus]
    ...unitMap, // [!code focus]
    ...customUnitMap, // [!code focus]
  ]) // [!code focus]
  return value / finallyUnitMap.get(unit) + unit; // [!code focus]
}
```

ç°åœ¨èƒ½å¤Ÿæ”¯æŒä½¿ç”¨è€…åŠ¨æ€æ·»åŠ å•ä½æ˜ å°„äº†ï¼Œä½†æ˜¯è¿™ä¸€ç‰ˆè¿˜æ˜¯æœ‰ç¼ºé™·ã€‚è™½ç„¶å•ä½æ˜ å°„èƒ½å¤ŸåŠ¨æ€æ‰©å±•æ·»åŠ ï¼Œä½†æ˜¯æ‰©å±•æ€§å¹¶æ²¡æœ‰é‚£ä¹ˆå¥½ï¼›æœ‰ä¸€äº›å•ä½å¯èƒ½ä¸æ˜¯ç®€ç®€å•å•å°±ç”¨é™¤æ³•è§£å†³ï¼Œè¿™é‡Œå†™æ­»ä¸ºé™¤æ³•æ˜¾ç„¶å¹¶ä¸åˆé€‚ã€‚

### ç¬¬ä¸‰ç‰ˆæ”¹è¿›

é’ˆå¯¹ç¬¬äºŒç‰ˆæ”¹è¿›çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿›è¡Œç¬¬ä¸‰ç‰ˆæ”¹è¿›ã€‚

æ—¢ç„¶è®¡ç®—çš„æ–¹å¼ä¸ç¡®å®šï¼Œé‚£ä¹ˆå¯ä»¥ä¿®æ”¹ `Map` æ˜ å°„ï¼Œå•ä½åé¢å¯ä»¥æ¥æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ¥æ–¹æ³•ï¼Œåœ¨æ ¹æ®å•ä½è·å–å€¼æ—¶åˆ¤æ–­è·å–åˆ°çš„æ˜¯å¦æ˜¯æ•°å­—ï¼Œå¦‚æœæ˜¯æ•°å­—åˆ™é»˜è®¤ç”¨é™¤æ³•è®¡ç®—ï¼›å¦‚æœæ˜¯æ–¹æ³•è¯´æ˜éœ€è¦ç”¨å…¶ä»–æ–¹å¼è®¡ç®—ï¼Œç›´æ¥è°ƒç”¨é‚£ä¸ªæ–¹æ³•å³å¯ã€‚

```js
const unitMap = new Map([
  'ç™¾': 100,
  'åƒ': 1000,
  'ä¸‡': 10000,
  'åä¸‡': 100000,
]);

function setUnit(value, unit, customUnitMap) {
  const finallyUnitMap = new Map([
    ...unitMap,
    ...customUnitMap,
  ])
  const unithandle = finallyUnitMap.get(unit); // [!code focus]
  if (typeof unithandle === 'number') { // [!code focus]
    return value / unithandle + unit; // [!code focus]
  } else if (typeof unithandle === 'function') { // [!code focus]
    return unithandle(value) + unit; // [!code focus]
  } // [!code focus]
}
```

## æ–¹ä¾¿æ€§æ”¹ç‰ˆ

ç›®å‰æ‰©å±•æ€§å·²ç»æœ‰äº†ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ–¹ä¾¿æ€§è¿˜æ²¡æœ‰ã€‚å¦‚æœä½¿ç”¨è€…æƒ³ä½¿ç”¨å®ƒï¼Œå¿…é¡»è¦ä¼ å€¼å’Œå•ä½ã€‚åœ¨ä¸€èˆ¬é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªé¡µé¢å¯èƒ½å•ä½éƒ½æ˜¯ç»Ÿä¸€çš„ï¼Œä½†å·¥å…·å‡½æ•°æ²¡æœ‰è®°å¿†åŠŸèƒ½ï¼Œæ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦å¸¦å•ä½ï¼Œå¾ˆéº»çƒ¦ï¼›å¦å¤–ä¸€äº›é¡¹ç›®æœ‰è‡ªå·±çš„å•ä½ï¼Œä¸”è¯¥å•ä½åœ¨è¿™ä¸ªé¡¹ç›®æ˜¯ç»å¸¸ç”¨åˆ°çš„ï¼Œä½†æ˜¯é»˜è®¤æ˜ å°„é‡Œé¢æ²¡æœ‰ï¼Œé‚£ä¹ˆä½¿ç”¨è€…æ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦è‡ªå·±ä¼ ï¼Œå¾ˆéº»çƒ¦ã€‚


ä¸ºå·¥å…·å‡½æ•°æ·»åŠ ä¸€ä¸ªè®°å¿†åŠŸèƒ½ï¼Œå¦‚æœä½¿ç”¨è€…ä¼ äº†å•ä½ï¼Œåˆ™ä½¿ç”¨ä¼ çš„ï¼›å¦‚æœä½¿ç”¨è€…æ²¡æœ‰ä¼ å•ä½ï¼Œåˆ™ä½¿ç”¨ä¸Šä¸€æ¬¡è®°å¿†ä¿ç•™çš„ã€‚

è®¾ç½®ä¸€ä¸ªå˜é‡ç”¨äºå­˜å‚¨è®°å¿†å•ä½ï¼Œå¯è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œæ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•éƒ½åˆ¤æ–­ä¸€ä¸‹ç”¨æˆ·æ˜¯å¦ä¼ äº†å•ä½ï¼Œä¼ äº†åˆ™æ›´æ–°è®°å¿†å•ä½å˜é‡ï¼Œæ²¡ä¼ åˆ™ç›´æ¥ä½¿ç”¨è®°å¿†å•ä½å˜é‡ã€‚

å¸¸ç”¨çš„å•ä½è¿™ç‚¹ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæ–¹æ³• `addUnit` ï¼Œå¦‚æœé¡¹ç›®ç¡®å®ç»å¸¸ä½¿ç”¨æŸäº›å•ä½ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ŒæŠŠå•ä½æ·»åŠ åˆ°é»˜è®¤æ˜ å°„å†…ã€‚

```js
const unitMap = new Map([
  'ç™¾': 100,
  'åƒ': 1000,
  'ä¸‡': 10000,
  'åä¸‡': 100000,
]);
const unitMemory = 'åƒ'

export function setUnit(value, unit, customUnitMap) {
  const finallyUnitMap = new Map([
    ...unitMap,
    ...customUnitMap,
  ])
  const finallyUnit = unit ? unitMemory = unit : unitMemory; // [!code focus]
  const unithandle = finallyUnitMap.get(finallyUnit); // [!code focus]
  if (typeof unithandle === 'number') {
    return value / unithandle + finallyUnit; // [!code focus]
  } else if (typeof unithandle === 'function') {
    return unithandle(value) + finallyUnit; // [!code focus]
  }
}

export function addUnit(customUnitMap) { // [!code focus]
  for (const [key, value] of customUnitMap) { // [!code focus]
    unitMap.set(key, value); // [!code focus]
  } // [!code focus]
} // [!code focus]
```

> [!NOTE] æç¤º
> ä¸‰å…ƒè¡¨è¾¾å¼å†…æ˜¯å¯ä»¥ä½¿ç”¨èµ‹å€¼è¯­å¥çš„ï¼Œèµ‹å€¼è¯­å¥è¿”å›çš„å°±æ˜¯èµ‹å€¼åçš„å€¼ã€‚è¿™æ ·æ—¢å¯ä»¥èµ‹å€¼ï¼Œåˆå¯ä»¥è¿”å›å€¼ã€‚

## å¥å£®æ€§æ”¹ç‰ˆ

ç›®å‰å·¥å…·å‡½æ•°å·²ç»å…·å¤‡æ‰©å±•æ€§ã€æ–¹ä¾¿æ€§å’Œå¥å£®æ€§ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚

1. å¦‚æœä½¿ç”¨è€…ä¼ çš„å€¼ä¸æ˜¯æ•°å­—ï¼Œåˆ™å·¥å…·å‡½æ•°ä¼šæŠ¥é”™ã€‚
2. å¦‚æœä½¿ç”¨è€…ä¼ çš„å•ä½æ˜¯æ˜ å°„å†…æ²¡æœ‰çš„ï¼Œåˆ™å·¥å…·å‡½æ•°ä¼šæŠ¥é”™ã€‚
3. å…¶ä»–æƒ…å†µ......

å› æ­¤æœ€åŸºç¡€çš„ï¼Œå‡½æ•°éœ€è¦æ·»åŠ ä¸€ä¸ªç±»å‹æ ¡éªŒåˆ¤æ–­ï¼Œå¦‚æœ `value` é€šè¿‡ `Number` è½¬æ¢åå¾—åˆ°çš„æ˜¯ `NaN` ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼›å¦‚æœå•ä½æ²¡æœ‰åœ¨æ˜ å°„è¡¨ä¸­ï¼Œä¹ŸæŠ›å‡ºå¼‚å¸¸æŠ¥é”™ã€‚

```js
const unitMap = new Map([
  'ç™¾': 100,
  'åƒ': 1000,
  'ä¸‡': 10000,
  'åä¸‡': 100000,
]);
const unitMemory = 'åƒ'

export function setUnit(value, unit, customUnitMap) {
  if (isNaN(Number(value))) { // [!code focus]
    console.warn(`${value}å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å€¼å‹`) // [!code focus]
    return value // [!code focus]
  } // [!code focus]
  const finallyUnitMap = new Map([
    ...unitMap,
    ...customUnitMap,
  ])
  const finallyUnit = unit ? unitMemory = unit : unitMemory;
  if (!finallyUnitMap.has(finallyUnit)) { // [!code focus]
    console.warn(`${unit}å•ä½ä¸å­˜åœ¨`) // [!code focus]
    return value // [!code focus]
  }
  const unithandle = finallyUnitMap.get(finallyUnit);
  if (typeof unithandle === 'number') {
    return value / unithandle + finallyUnit;
  } else if (typeof unithandle === 'function') {
    return unithandle(value) + finallyUnit;
  }
}

export function addUnit(customUnitMap) {
  for (const [key, value] of customUnitMap) {
    unitMap.set(key, value);
  }
}
```

> [!NOTE] ğŸ“— è¡¥å……
> è¿™é‡Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ `throw new Error()` ï¼Œä½†æ˜¯è¿™æ ·ä¼šä¸­æ–­å‡½æ•°æ‰§è¡Œï¼Œå¦‚æœä½¿ç”¨è€…ä¸å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œåˆ™ä¼šå¯¼è‡´é¡µé¢å´©æºƒï¼Œå› æ­¤è¿™é‡Œåªæ˜¯ `console.warn` è­¦å‘Šä¸€ä¸‹ï¼Œä½¿ç”¨è€…å¯ä»¥é€‰æ‹©å¤„ç†è¿™ä¸ªè­¦å‘Šï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸å¤„ç†ï¼Œæ‰‹æ®µæ›´æ¸©å’Œä¸€ç‚¹ã€‚

## æœ€ç»ˆä»£ç 

```js
// é»˜è®¤å•ä½æ˜ å°„è¡¨
const unitMap = new Map([
  'ç™¾': 100,
  'åƒ': 1000,
  'ä¸‡': 10000,
  'åä¸‡': 100000,
]);
const unitMemory = 'åƒ' // å•ä½è®°å¿†

export function setUnit(value, unit, customUnitMap) {
  // å¦‚æœvalueä¸æ˜¯æ•°å€¼ï¼Œåˆ™æŠ›å‡ºè­¦å‘Š
  if (isNaN(Number(value))) {
    console.warn(`${value}å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å€¼å‹`)
    return value
  }
  const finallyUnitMap = new Map([
    ...unitMap,
    ...customUnitMap,
  ])
  // è®°å¿†å•ä½
  const finallyUnit = unit ? unitMemory = unit : unitMemory;
  // å¦‚æœå•ä½ä¸åœ¨æ˜ å°„è¡¨å†…ï¼Œåˆ™æŠ›å‡ºè­¦å‘Š
  if (!finallyUnitMap.has(finallyUnit)) {
    console.warn(`${unit}å•ä½ä¸å­˜åœ¨`)
    return value
  }
  const unithandle = finallyUnitMap.get(finallyUnit);
  // å¦‚æœå•ä½æ˜ å°„è¡¨å†…æ˜¯æ•°å€¼ï¼Œåˆ™é™¤ä»¥æ•°å€¼ï¼›å¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨å‡½æ•°
  if (typeof unithandle === 'number') {
    return value / unithandle + finallyUnit;
  } else if (typeof unithandle === 'function') {
    return unithandle(value) + finallyUnit;
  }
}

// æ·»åŠ è‡ªå®šä¹‰å•ä½æ˜ å°„è¡¨
export function addUnit(customUnitMap) {
  for (const [key, value] of customUnitMap) {
    unitMap.set(key, value);
  }
}
```

## æ€»ç»“

å¯¹äºä»£ç å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§çš„è¿½æ±‚ï¼Œç”¨æ›´åˆç†çš„æ•°æ®ç»“æ„å’Œä»£ç ç»“æ„ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚å¦‚ç¤ºä¾‹ä¸­ä½¿ç”¨ `Map` æ˜ å°„è€Œä¸ç”¨æ•°ç»„ï¼Œè¿™æ ·å°±å‡å°‘äº†æ•°ç»„å¾ªç¯çš„æ“ä½œã€‚

å¯¹äºå¯æ‹“å±•æ€§ï¼Œå†…ç½®æœ€å¸¸ç”¨çš„æ“ä½œï¼Œç•™å‡ºå‚æ•°è®©ä½¿ç”¨æ—¶å€™ä¼ å…¥è‡ªå®šä¹‰ã€‚

å¯¹äºå¥å£®æ€§ï¼Œå¯¹äºä¸€äº›å¯èƒ½ä¼šå¼•èµ·çš„è¾¹ç•Œæƒ…å†µï¼Œåšå¥½æ ¡éªŒï¼ŒæŠ›å‡ºæ˜“æ‡‚çš„æŠ¥é”™æç¤ºã€‚