---
title: 前端动图动效方案
isReship: true
author:
  - 三十的前端课 前端动图动效方案最佳实践汇总^https://www.bilibili.com/video/BV1rqTEzxExT/
---

# 前端动图动效方案

## 图片方案

|名称|体积|质量|兼容性|透明底支持|
|:-:|:-:|:-:|:-:|:-:|
|GIF|同等质量下最大|质量低|基本全兼容|无法透明底|
|aPNG|同等质量下小于gif|质量高|兼容比较新的现代浏览器|支持透明底|
|WebP|同等质量下小于apng|质量高|比apng好，但是ios比apng差|支持透明底|
|AVIF|同等质量下最小|质量极高|非常差，chrome需要85+，ios要16+|支持透明底|

## 最佳实践

优先使用 `webp` 作为首选，从大小和兼容性上都比 `apng` 好，而 `avif` 兼容性太差，不去考虑。

同时还可以针对动图做一个降级方案，优先使用 `webp` ，如果浏览器不支持 `webp` ，则使用 `apng` ，如果 `apng` 也不支持，则使用保底方案 `gif` 。

可以写一个 `js` 函数，用于处理动图降级处理。核心思路为：
- `new Image` 创建一个 `img` 标签，分别加载 `avif` 和 `webp` ，哪个成功用哪个
- 判断好支持哪个再去挂载 DOM，因此需要用到 `promise` 实现异步操作
- 异步执行完毕后再去加载 `vue`

::: code-group
```js [imgSupport.js]
export function imgSupport() {
  return new Promise((resolve, reject) => {
    window.picSupport = 'low'
    const imgAvif = new Image()
    imgAvif.src = 'data:image/avif;base64,YWN0aXZlL3d3dy5nb29nbGUuY29tCg=='
    imgAvif.onload = () => {
      // 支持avif
      window.picSupport = 'avif'
      resolve()
    }
    imgAvif.onerror = () => {
      // 不支持avif，试试加载webp
      const imgWebp = new Image()
      imgWebp.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA'
      imgWebp.onload = () => {
        // 支持webp
        window.picSupport = 'webp'
        resolve()
      }
      imgWebp.onerror = () => {
        // 也不支持webp，则默认low用gif
        resolve()
      }
    }
  })
}
```
```js [main.js]
import { imgSupport } from './imgSupport.js'
import App from './App.vue'

imgSupport().then(() => {
  createApp(App).mount('#app')
})
```
:::

这里需要注意的是，要提前准备好三张非常小的 `avif`、`webp` 格式的图片（可以准备一个 1*1 的 `png` 图片，然后格式转换），然后转为 `base64` ，直接写到代码中，用于判断浏览器是否支持 `avif` 和 `webp` ，速度能更快点。

而且必须是真 `avif` 和 `webp` 图片，不能通过文件重命名修改后缀的方式。推荐使用网站 [ezgif](https://ezgif.com/) 进行格式转换。

## 动画方案

|名称|体积|质量|兼容性|开发者麻烦程度|制作工具|
|:-:|:-:|:-:|:-:|:-:|:-:|
|css动画|体积最小|高清无损|和css3兼容性一致，支持keyframe就能做，兼容性最好|麻烦，要写html配合css|自己写|
|canvas动画|体积一般不大，吃运算内存|高清无损，但可能会卡|支持canvas就行，兼容性比css差点|最麻烦，写大量js配合定时器更新动画|自己写|
|lottie|体积一般，需要额外安装lottie播放库|高清无损，但可能会卡|需要支持svg、css3、es5，要求稍微高点，chrome 45+，los9，andorid4以下可能有问题|一键引入库直接使用|AE，素材网站|

### lottie的使用